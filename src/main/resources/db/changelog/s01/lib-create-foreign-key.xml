<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="lib-create-user-service-table" author="donald-amagana">
        <!-- ========================= -->
        <!-- FK vers department (OBLIGATOIRE) -->
        <!-- ========================= -->
        <addForeignKeyConstraint
                baseTableName="services"
                baseColumnNames="department_id"
                referencedTableName="department"
                referencedColumnNames="id"
                constraintName="fk_service_department"
                onDelete="RESTRICT"/>

        <!-- ========================= -->
        <!-- FK vers manager -->
        <!-- ========================= -->
        <addForeignKeyConstraint
                baseTableName="services"
                baseColumnNames="manager_id"
                referencedTableName="user_entity"
                referencedColumnNames="id"
                constraintName="fk_service_manager"
                onDelete="SET NULL"/>

        <!-- ========================= -->
        <!-- FK vers department -->
        <!-- ========================= -->
        <addForeignKeyConstraint
                baseTableName="user_entity"
                baseColumnNames="department_id"
                referencedTableName="department"
                referencedColumnNames="id"
                constraintName="fk_user_department"/>

        <!-- ========================= -->
        <!-- FK vers service -->
        <!-- ========================= -->
        <addForeignKeyConstraint
                baseTableName="user_entity"
                baseColumnNames="service_id"
                referencedTableName="services"
                referencedColumnNames="id"
                constraintName="fk_user_service"/>

    </changeSet>
</databaseChangeLog>